# 📈 台灣股票分析平台

一個功能強大的台灣股票分析平台，提供股票篩選、策略回測和投資組合分析功能。使用本地TWSE數據庫確保數據穩定性和查詢速度。

## 🔧 最新更新 - v3.2.1 (2024-12-19)

### 🚨 重大問題修復與功能重建

**問題背景:**
- 應用在Streamlit Cloud上出現語法錯誤，主要在第1262行附近
- 重命名過程中導致多項核心功能丟失
- 股票篩選頁面出現KeyError錯誤，欄位映射不一致
- 策略回測功能不完整，缺少完整的布林通道和突破策略實現

**修復過程:**

1. **語法錯誤修復**
   - ✅ 修復第1262行語法錯誤（錯誤放置的`st.metric`調用）
   - ✅ 重建完整的主函數和頁面導航邏輯
   - ✅ 統一代碼結構和錯誤處理

2. **數據欄位映射修復**
   - ✅ 解決KeyError問題，修復欄位名稱不一致（'ROE'vs'ROE(%)'）
   - ✅ 建立完整的欄位映射機制
   - ✅ 增強數據載入的錯誤處理和提示

3. **功能完整重建**
   - ✅ 完整實現布林通道策略（移動平均、標準差、上下軌計算）
   - ✅ 完整實現突破策略（趨勢判斷、突破進場、成交量過濾、風險控制）
   - ✅ 統一回測結果顯示UI，包含詳細交易記錄和圖表
   - ✅ 重建投資組合分析功能（權重分配、風險分析、投資建議）

**新增核心功能:**

### 📊 布林通道策略 (完整實現)
- **技術指標**: 20日移動平均線、2倍標準差上下軌
- **交易邏輯**: 
  - 買入信號：價格從下方突破下軌
  - 賣出信號：價格從上方突破上軌
- **風險控制**: 完整的資產追蹤和交易記錄
- **視覺化**: 布林通道圖表、買賣點標記、投資組合價值走勢

### 🎯 突破策略 (全新實現)
- **進場條件** (三條件同時滿足):
  1. 趨勢判斷：股價站上20日與60日均線
  2. 突破進場：收盤價突破20日高點
  3. 成交量過濾：成交量大於5日平均量
- **出場條件** (任一條件觸發):
  1. 停損：跌破進場價-6%
  2. 停利：達到+15%報酬
  3. 追蹤出場：跌破10日均線
- **技術指標**: MA10、MA20、MA60、20日高點、成交量分析

### 🏠 本地TWSE數據庫支援
- ✅ 支援443支股票的本地歷史數據
- ✅ 無需網路連線，快速數據載入
- ✅ 完整的錯誤處理和數據驗證
- ✅ 數據庫狀態監控和統計顯示

### 📈 統一回測結果UI
- **績效指標**: 初始/最終資金、總報酬率、勝率統計
- **交易記錄**: 完整的買賣記錄表格，包含信號類型和報酬率
- **視覺化圖表**: 
  - 雙軸圖表（投資組合價值 vs 股價走勢）
  - 技術指標圖表（布林通道或移動平均線）
  - 買賣點標記和信號顯示
- **策略說明**: 詳細的策略邏輯和參數說明

### 💼 投資組合分析 (重新設計)
- **組合建立**: 股票選擇、權重設定、即時統計
- **視覺化**: 權重分布圓餅圖、統計儀表板
- **風險分析**: 多樣性分析、權重分散度、行業分散度
- **投資建議**: 智能建議系統、風險提醒、優質股票推薦

**技術改進:**
- ✅ 完整的錯誤處理和用戶體驗優化
- ✅ 響應式設計和美觀的UI界面
- ✅ 模組化代碼結構，易於維護和擴展
- ✅ 詳細的日誌記錄和調試信息

**部署狀態:**
- ✅ 語法檢查通過，無語法錯誤
- ✅ 所有功能模組完整實現
- ✅ 準備提交v3.2.1版本到GitHub
- ✅ 可在Streamlit Cloud正常運行

## 🚀 專案進度總結

### ✅ 已完成功能 (100%)
- **🔍 股票篩選工具**: 完整的多指標篩選系統
- **📊 個股策略回測**: 布林通道策略回測功能
- **📈 投資組合分析**: 投資組合管理和分析
- **💾 本地TWSE數據庫**: 443支股票的3年歷史數據
- **🌐 雲端部署**: Streamlit Cloud 自動部署
- **📊 數據視覺化**: 互動式圖表和分析
- **🔄 數據更新機制**: 自動化數據更新和部署

### 📊 數據完整性
- **財務數據**: 726支台灣股票完整基本面數據 ✅
- **價格數據**: 443支股票，每支約728筆交易記錄（3年歷史）✅
- **數據源**: TWSE官方API，確保數據準確性 ✅
- **更新機制**: 支援手動和自動更新 ✅

### 🎯 功能完成度
| 功能模組 | 完成度 | 狀態 |
|---------|--------|------|
| 股票篩選工具 | 100% | ✅ 完成 |
| 策略回測系統 | 100% | ✅ 完成 |
| 投資組合分析 | 100% | ✅ 完成 |
| 數據管理系統 | 100% | ✅ 完成 |
| 雲端部署 | 100% | ✅ 完成 |
| 用戶界面 | 100% | ✅ 完成 |

## ✨ 主要功能

### 🔍 股票篩選工具
- 📊 **智能篩選**: 基於 ROE、EPS、年營收成長率、月營收成長率等關鍵指標
- 🎛️ **滑動條界面**: 直觀的拖拉調整，實時篩選結果
- ⚡ **快速預設**: 積極成長、價值投資、保守投資、高成長等策略一鍵設定
- 📈 **數據視覺化**: 互動式圖表分析，包含散點圖和分布圖
- 📋 **完整數據**: 726支台灣股票的完整財務數據

### 📊 個股策略回測
- 🎯 **布林通道策略**: 專業的技術分析策略回測
- 📈 **股價走勢圖**: 清晰的價格圖表和技術指標
- 💰 **投資組合追蹤**: 實時計算策略表現和報酬率
- 📋 **交易記錄**: 詳細的買賣點記錄和分析
- 🔄 **策略比較**: 與買入持有策略的表現對比
- 🎛️ **參數調整**: 靈活的策略參數自訂功能

### 📈 投資組合分析
- 📊 **組合管理**: 多股票投資組合建立和管理
- 📈 **績效分析**: 詳細的投資組合表現分析
- 🎯 **風險評估**: 投資組合風險指標計算
- 📋 **資產配置**: 智能資產配置建議

### 💾 本地TWSE數據庫
- 🏦 **官方數據源**: 直接從台灣證券交易所API獲取
- 💾 **本地存儲**: 443支股票的3年歷史價格數據
- ⚡ **快速查詢**: 無需網路連線，即時數據載入
- 🔄 **增量更新**: 支援數據自動更新和同步

## 🚀 快速開始

### 前置需求
- Python 3.8+
- pip

### 安裝步驟

```bash
# 克隆專案
git clone [repository-url]
cd stock-crowd

# 安裝依賴
pip install -r requirements.txt

# 啟動應用
streamlit run stock_strategy_app.py
```

### 或使用Python模組方式啟動
```bash
python -m streamlit run stock_strategy_app.py
```

## 📊 數據準備

### 方法1: 使用現有數據（推薦）
專案已包含443支股票的完整歷史數據，可直接使用。

### 方法2: 下載最新數據
```bash
# 執行TWSE數據下載器
python twse_data_downloader.py

# 選擇下載選項
# 1. 下載所有股票數據（推薦）
# 2. 查看可用股票
# 3. 下載單一股票
```

## 🎯 使用指南

### 股票篩選工具
1. **設定篩選條件**: 使用左側滑動條調整各項財務指標
2. **快速預設策略**:
   - 💎 **積極成長**: ROE>20%, EPS>2, 年成長>30%, 月成長>30%
   - 💰 **價值投資**: ROE>15%, EPS>1, 年成長>10%, 月成長>5%
   - 🛡️ **保守投資**: ROE>10%, EPS>0.5, 年成長>5%, 月成長>0%
   - 🔥 **高成長**: ROE>5%, EPS>0, 年成長>50%, 月成長>40%
3. **查看結果**: 符合條件的股票即時顯示，包含圖表分析

### 個股策略回測
1. **選擇股票**: 手動輸入代碼或從可用列表選擇
2. **設定期間**: 選擇1年、2年、3年或5年回測期間
3. **調整參數**: 
   - 移動平均週期（5-50天）
   - 標準差倍數（1.0-3.0）
   - 初始資金（自訂金額）
4. **執行回測**: 查看策略表現、交易記錄和比較分析

### 投資組合分析
1. **建立組合**: 選擇多支股票建立投資組合
2. **設定權重**: 調整各股票在組合中的權重
3. **分析表現**: 查看組合整體表現和風險指標
4. **優化建議**: 獲得資產配置優化建議

## 📁 專案結構

```
stock-crowd/
├── stock_strategy_app.py           # 主應用程序（多頁面）
├── twse_data_downloader.py         # TWSE數據下載器
├── taiwan_stock_analyzer.py        # 股票分析器
├── requirements.txt                # 依賴包列表
├── data/
│   ├── stock_prices/              # 本地股價數據庫（443支股票）
│   ├── processed/                 # 處理後的財務數據（726支股票）
│   └── logs/                      # 下載日誌
├── STRATEGY_BACKTEST_GUIDE.md     # 策略回測詳細指南
├── DATA_UPDATE_GUIDE.md           # 數據更新指南
├── DEPLOYMENT_GUIDE.md            # 部署指南
├── PROJECT_SUMMARY.md             # 專案總結
└── README.md                      # 專案說明
```

## 🔧 技術棧

- **Frontend**: Streamlit
- **數據處理**: Pandas, NumPy
- **視覺化**: Plotly
- **技術分析**: TA-Lib, yfinance
- **數據源**: 台灣證券交易所 (TWSE) API
- **語言**: Python 3.8+

## 📊 數據規模

- **財務數據**: 726支台灣股票完整基本面數據
- **價格數據**: 443支股票，每支約728筆交易記錄（3年歷史）
- **更新頻率**: 支援手動和自動更新
- **數據來源**: TWSE官方API，確保數據準確性

## 🌐 部署選項

### 本地部署（推薦）
```bash
streamlit run stock_strategy_app.py
```

### 雲端部署
- **Streamlit Cloud**: 免費，推薦用於展示
- **Heroku**: 支援自動部署
- **Railway**: 快速部署選項
- **Render**: 免費層可用

詳細部署指南請參考 `DEPLOYMENT_GUIDE.md`

## 📈 功能特色

### 股票篩選
- ✅ 726支股票完整財務數據
- ✅ 實時滑動條篩選
- ✅ 多種投資策略預設
- ✅ 互動式圖表分析
- ✅ 篩選結果統計

### 策略回測
- ✅ 布林通道專業策略
- ✅ 本地數據快速載入
- ✅ 詳細交易記錄
- ✅ 策略表現比較
- ✅ 參數靈活調整
- ✅ 視覺化分析圖表

### 投資組合分析
- ✅ 多股票組合管理
- ✅ 風險收益分析
- ✅ 資產配置優化
- ✅ 績效追蹤報告

### 數據管理
- ✅ TWSE官方數據源
- ✅ 本地數據庫存儲
- ✅ 增量更新機制
- ✅ 數據完整性檢查
- ✅ 詳細下載日誌

## 🔍 使用範例

### 範例1: 尋找高ROE成長股
1. 進入「🔍 股票篩選工具」
2. 點擊「💎 積極成長」預設
3. 查看符合條件的股票列表
4. 分析ROE vs EPS散點圖

### 範例2: 台積電布林通道回測
1. 進入「📊 個股策略回測」
2. 輸入股票代碼：`2330`
3. 選擇期間：`1y`
4. 執行回測，分析結果

### 範例3: 建立投資組合
1. 進入「📈 投資組合分析」
2. 選擇多支優質股票
3. 設定投資權重
4. 分析組合表現

## ⚠️ 重要說明

### 投資風險提醒
- 本工具僅供教育和研究用途
- 過去績效不代表未來表現
- 投資前請進行充分的風險評估
- 建議結合基本面分析做決策

### 技術限制
- 回測未考慮交易成本
- 假設按收盤價成交
- 不包含股利分配計算
- 數據更新需手動執行

## 🆘 故障排除

### 常見問題

**Q: 無法啟動應用**
```bash
# 嘗試使用模組方式啟動
python -m streamlit run stock_strategy_app.py
```

**Q: 找不到股票數據**
```bash
# 執行數據下載器
python twse_data_downloader.py
```

**Q: 回測失敗**
- 檢查股票代碼是否正確
- 確認本地數據是否存在
- 嘗試調整回測期間

## 📞 支持與貢獻

- 🐛 **問題回報**: 請提交 GitHub Issue
- 💡 **功能建議**: 歡迎提出改進建議
- 🔧 **貢獻代碼**: 歡迎提交 Pull Request

## 📄 相關文檔

- [策略回測詳細指南](STRATEGY_BACKTEST_GUIDE.md)
- [數據更新指南](DATA_UPDATE_GUIDE.md)
- [部署指南](DEPLOYMENT_GUIDE.md)
- [專案總結](PROJECT_SUMMARY.md)

## 🎯 專案里程碑

### 第一階段 ✅ (已完成)
- 基礎股票篩選功能
- 數據爬蟲和處理
- 基本用戶界面

### 第二階段 ✅ (已完成)
- 策略回測系統
- 本地數據庫建立
- 進階篩選功能

### 第三階段 ✅ (已完成)
- 投資組合分析
- 雲端部署
- 完整文檔

### 未來規劃 🚀
- 更多技術指標
- 機器學習預測
- 移動端優化
- API 接口開發

---

**Made with ❤️ for Taiwan Stock Market Analysis**

*最後更新: 2024年12月*
*專案狀態: 生產就緒 (Production Ready)* 