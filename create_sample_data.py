import pandas as pd
import numpy as np
import os
from datetime import datetime

def create_sample_stock_data():
    """å‰µå»ºç¤ºä¾‹è‚¡ç¥¨æ•¸æ“š"""
    
    # ç¢ºä¿data/processedç›®éŒ„å­˜åœ¨
    os.makedirs('data/processed', exist_ok=True)
    
    # å°ç£çŸ¥åè‚¡ç¥¨åˆ—è¡¨ï¼ˆç¤ºä¾‹ï¼‰
    sample_stocks = [
        ('2330.TW', 'å°ç©é›»'),
        ('2317.TW', 'é´»æµ·'),
        ('2454.TW', 'è¯ç™¼ç§‘'),
        ('2891.TW', 'ä¸­ä¿¡é‡‘'),
        ('2882.TW', 'åœ‹æ³°é‡‘'),
        ('2303.TW', 'è¯é›»'),
        ('2002.TW', 'ä¸­é‹¼'),
        ('2881.TW', 'å¯Œé‚¦é‡‘'),
        ('2886.TW', 'å…†è±é‡‘'),
        ('2395.TW', 'ç ”è¯'),
        ('2412.TW', 'ä¸­è¯é›»'),
        ('1301.TW', 'å°å¡‘'),
        ('1303.TW', 'å—äºž'),
        ('2207.TW', 'å’Œæ³°è»Š'),
        ('2308.TW', 'å°é”é›»'),
        ('2357.TW', 'è¯ç¢©'),
        ('2382.TW', 'å»£é”'),
        ('2603.TW', 'é•·æ¦®'),
        ('3008.TW', 'å¤§ç«‹å…‰'),
        ('6505.TW', 'å°å¡‘åŒ–'),
        ('2327.TW', 'åœ‹å·¨'),
        ('2379.TW', 'ç‘žæ˜±'),
        ('2344.TW', 'è¯é‚¦é›»'),
        ('2301.TW', 'å…‰å¯¶ç§‘'),
        ('1216.TW', 'çµ±ä¸€'),
        ('2385.TW', 'ç¾¤å…‰'),
        ('2409.TW', 'å‹é”'),
        ('2408.TW', 'å—äºžç§‘'),
        ('2884.TW', 'çŽ‰å±±é‡‘'),
        ('2892.TW', 'ç¬¬ä¸€é‡‘'),
        ('3711.TW', 'æ—¥æœˆå…‰æŠ•æŽ§'),
        ('2609.TW', 'é™½æ˜Ž'),
        ('2615.TW', 'è¬æµ·'),
        ('2204.TW', 'ä¸­è¯'),
        ('2323.TW', 'ä¸­ç’°'),
        ('2474.TW', 'å¯æˆ'),
        ('3034.TW', 'è¯è© '),
        ('2376.TW', 'æŠ€å˜‰'),
        ('3045.TW', 'å°ç£å¤§'),
        ('4904.TW', 'é å‚³'),
        ('2912.TW', 'çµ±ä¸€è¶…'),
        ('2105.TW', 'æ­£æ–°'),
        ('1102.TW', 'äºžæ³¥'),
        ('1101.TW', 'å°æ³¥'),
        ('2105.TW', 'æ­£æ–°'),
        ('6415.TW', 'çŸ½åŠ›-KY'),
        ('3443.TW', 'å‰µæ„'),
        ('2360.TW', 'è‡´èŒ‚'),
        ('3231.TW', 'ç·¯å‰µ'),
        ('6669.TW', 'ç·¯ç©Ž')
    ]
    
    # ç”Ÿæˆéš¨æ©Ÿä½†åˆç†çš„è²¡å‹™æ•¸æ“š
    np.random.seed(42)  # è¨­å®šéš¨æ©Ÿç¨®å­ä»¥ç¢ºä¿çµæžœä¸€è‡´
    
    data = []
    for stock_code, name in sample_stocks:
        # ç”Ÿæˆåˆç†çš„è²¡å‹™æŒ‡æ¨™
        roe = np.random.normal(15, 10)  # ROE å¹³å‡15%ï¼Œæ¨™æº–å·®10%
        roe = max(-50, min(80, roe))  # é™åˆ¶åœ¨åˆç†ç¯„åœå…§
        
        eps = np.random.normal(3, 2)  # EPS å¹³å‡3ï¼Œæ¨™æº–å·®2
        eps = max(-10, min(50, eps))  # é™åˆ¶åœ¨åˆç†ç¯„åœå…§
        
        # å¹´ç‡Ÿæ”¶æˆé•·çŽ‡ï¼ˆå¯èƒ½ç‚ºè² ï¼‰
        annual_growth = np.random.normal(10, 25)
        annual_growth = max(-100, min(200, annual_growth))
        
        # æœˆç‡Ÿæ”¶æˆé•·çŽ‡ï¼ˆé€šå¸¸æ¯”å¹´æˆé•·çŽ‡æ³¢å‹•æ›´å¤§ï¼‰
        monthly_growth = np.random.normal(8, 30)
        monthly_growth = max(-100, min(300, monthly_growth))
        
        data.append({
            'stock_code': stock_code,
            'name': name,
            'ROE': round(roe, 2),
            'EPS': round(eps, 2),
            'å¹´ç‡Ÿæ”¶æˆé•·çŽ‡': round(annual_growth, 2),
            'æœˆç‡Ÿæ”¶æˆé•·çŽ‡': round(monthly_growth, 2)
        })
    
    # å‰µå»ºDataFrame
    df = pd.DataFrame(data)
    
    # ä¿å­˜åˆ°CSVæ–‡ä»¶
    filename = f'data/processed/stock_data_{datetime.now().strftime("%Y%m%d_%H%M%S")}.csv'
    df.to_csv(filename, index=False, encoding='utf-8-sig')
    
    print(f"âœ… ç¤ºä¾‹è‚¡ç¥¨æ•¸æ“šå·²ç”Ÿæˆ: {filename}")
    print(f"ðŸ“Š åŒ…å« {len(df)} æ”¯è‚¡ç¥¨çš„æ•¸æ“š")
    print("\nå‰5ç­†æ•¸æ“šé è¦½:")
    print(df.head())
    
    # é¡¯ç¤ºä¸€äº›çµ±è¨ˆä¿¡æ¯
    print(f"\nðŸ“ˆ æ•¸æ“šçµ±è¨ˆ:")
    print(f"ROE ç¯„åœ: {df['ROE'].min():.2f}% ~ {df['ROE'].max():.2f}%")
    print(f"EPS ç¯„åœ: {df['EPS'].min():.2f} ~ {df['EPS'].max():.2f}")
    print(f"å¹´ç‡Ÿæ”¶æˆé•·çŽ‡ç¯„åœ: {df['å¹´ç‡Ÿæ”¶æˆé•·çŽ‡'].min():.2f}% ~ {df['å¹´ç‡Ÿæ”¶æˆé•·çŽ‡'].max():.2f}%")
    print(f"æœˆç‡Ÿæ”¶æˆé•·çŽ‡ç¯„åœ: {df['æœˆç‡Ÿæ”¶æˆé•·çŽ‡'].min():.2f}% ~ {df['æœˆç‡Ÿæ”¶æˆé•·çŽ‡'].max():.2f}%")
    
    # é¡¯ç¤ºç¬¦åˆé«˜æ¨™æº–çš„è‚¡ç¥¨æ•¸é‡
    high_quality = df[
        (df['ROE'] > 15) & 
        (df['EPS'] > 0) & 
        (df['å¹´ç‡Ÿæ”¶æˆé•·çŽ‡'] > 20) & 
        (df['æœˆç‡Ÿæ”¶æˆé•·çŽ‡'] > 20)
    ]
    print(f"\nðŸŽ¯ ç¬¦åˆé«˜æ¨™æº–çš„è‚¡ç¥¨æ•¸é‡ (ROE>15%, EPS>0, å¹´æˆé•·>20%, æœˆæˆé•·>20%): {len(high_quality)}")
    
    return filename

if __name__ == "__main__":
    create_sample_stock_data() 